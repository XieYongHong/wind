<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>智慧风场</title>
    <link rel="stylesheet" href="css/index.css">
</head>

<body>
    <div class="content">
        <div id="map"></div>
        <div class="legend">
            <div>
                <img src="" class="work-order">
                <span>无工单</span>
            </div>
            <div>
                <img src="" class="work-order">
                <span>预警工单</span>
            </div>
            <div>
                <img src="" class="work-order">
                <span>故障工单</span>
            </div>
            <div>
                <img src="" class="work-order">
                <span>运维工单</span>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=gSopVcsvgn0uSpjMBbR3nhvBvkYb1W70"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/map.js"></script>
    <script>
        var map = new Map({
            dom: 'map'
        })
        map.init()
        var login = function() {
            $.ajax({
                type: "get",
                url: "/login",
                data: {},
                success: function (data) {
                    console.log(data);
                }
            });
        }
        var getMarkers = function(){
            $.ajax({
                type: "get",
                url: "/getWorkOrder",
                data: {},
                success: function (data) {
                    console.log(data);
                    if(data.code == 200){
                        var datas = data.data
                        var arr = []
                        if(datas.length){
                            datas.forEach(a => {
                                a.iconUrl = '/img/Farm.png'
                                a.w = 52
                                a.h = 49
                                a.imageOffset = [24, 25]
                                if(a.type == 2){
                                    a.iconUrl = '/img/SpareParts.png'
                                    a.w = 61
                                    a.h = 44
                                    a.imageOffset = [30, 22]
                                }
                                arr.push(a)
                            });
                            map.addMarker(arr)
                        }
                    }
                }
            });
        }

        var RealTimeMarker = function() {
            var ws = new WebSocket('ws://')
            ws.onopen = function(){
                console.log('连接成功');
            }
            ws.onmessage = function(data) {
                console.log(data);
            }
            ws.onclose = function(){
                console.log('连接中断');
            }
        }
        login()
        getMarkers()
    </script>
</body>

</html>